<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Bot√≥n Sonoro</title>
    
    <!-- Metadatos para hacer que se vea como una app -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bot√≥n Sonoro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Bot√≥n Sonoro">
    
    <!-- Iconos para diferentes dispositivos -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxjaXJjbGUgY3g9IjkwIiBjeT0iOTAiIHI9IjUwIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNzUgNzBMNzUgMTEwTDExMCA5MEw3NSA3MFoiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxODAiIHkyPSIxODAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0idXJsKCNncmFkaWVudDBfbGluZWFyXzFfMSkiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iOSIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTEzIDEyTDEzIDIwTDIwIDE2TDEzIDEyWiIgZmlsbD0iIzY2N2VlYSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudDBfbGluZWFyXzFfMSIgeDE9IjAiIHkxPSIwIiB4Mj0iMzIiIHkyPSIzMiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjNjY3ZWVhIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzc2NGJhMiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgoK">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 100%;
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 1.5em;
        }

        .file-input-container {
            margin-bottom: 20px;
        }

        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .file-input-label:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        #audioFile {
            display: none;
        }

        .sound-button {
            padding: 20px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin: 20px;
            min-width: 150px;
        }

        .sound-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .sound-button:active {
            transform: translateY(-2px);
        }

        .sound-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }

        .instructions h3 {
            margin-top: 0;
            color: #333;
        }

        .instructions ol {
            margin: 10px 0;
        }

        .instructions li {
            margin: 8px 0;
            line-height: 1.4;
        }

        .file-info {
            margin: 15px 0;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
            color: #2e7d32;
        }

        .warning {
            background: rgba(255, 152, 0, 0.1);
            color: #f57c00;
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9em;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 1.3em;
            }
            
            .sound-button {
                padding: 15px 30px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîä Mi Bot√≥n</h1>
        
        <div class="file-input-container">
            <label for="audioFile" class="file-input-label">
                üìÅ Seleccionar Sonido
            </label>
            <input type="file" id="audioFile" accept="audio/*">
        </div>
        
        <div id="fileInfo" class="file-info" style="display: none;">
            <strong>Archivo cargado:</strong> <span id="fileName"></span>
        </div>
        
        <button id="soundButton" class="sound-button" disabled>
            üéµ ¬°Reproducir!
        </button>
        
        <div class="warning">
            <strong>‚ö†Ô∏è GitHub Pages:</strong> Tu sonido se guarda en el navegador del dispositivo. Si cambias de navegador o borras datos, necesitar√°s subirlo de nuevo.
        </div>
        
        <div class="instructions">
            <h3>üìã Instrucciones de uso:</h3>
            <ol>
                <li><strong>Primera vez:</strong> Selecciona tu sonido - se guardar√° autom√°ticamente</li>
                <li><strong>Siguientes veces:</strong> Tu sonido se carga solo al abrir la app</li>
                <li><strong>Cambiar sonido:</strong> Selecciona uno nuevo y reemplazar√° el anterior</li>
                <li><strong>¬°Disfruta!</strong> Funciona offline y sin recargas</li>
            </ol>
            
            <h3>üí° Consejos:</h3>
            <ul style="list-style: none; padding: 0;">
                <li>‚Ä¢ Archivos recomendados: MP3, WAV, OGG</li>
                <li>‚Ä¢ Tama√±o m√°ximo recomendado: 5MB</li>
                <li>‚Ä¢ Funciona offline una vez cargado</li>
                <li>‚Ä¢ Compatible con todos los m√≥viles</li>
            </ul>
        </div>
    </div>

    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        const audioFile = document.getElementById('audioFile');
        const soundButton = document.getElementById('soundButton');
        const audioPlayer = document.getElementById('audioPlayer');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        
        let audioEnabled = false;
        let savedAudioData = null;
        let savedFileName = '';

        // Funci√≥n para guardar audio en memoria del navegador
        function saveAudioToStorage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const audioData = e.target.result;
                savedAudioData = audioData;
                savedFileName = file.name;
                
                // Guardar en memoria persistente del navegador usando IndexedDB
                try {
                    // Crear una base de datos simple en el navegador
                    const dbRequest = indexedDB.open('SoundButtonDB', 1);
                    
                    dbRequest.onupgradeneeded = function(event) {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('sounds')) {
                            const store = db.createObjectStore('sounds', { keyPath: 'id' });
                        }
                    };
                    
                    dbRequest.onsuccess = function(event) {
                        const db = event.target.result;
                        const transaction = db.transaction(['sounds'], 'readwrite');
                        const store = transaction.objectStore('sounds');
                        
                        const audioInfo = {
                            id: 'myCustomSound',
                            data: audioData,
                            name: file.name,
                            type: file.type,
                            savedAt: new Date().toISOString()
                        };
                        
                        store.put(audioInfo);
                        console.log('Audio guardado en IndexedDB:', file.name);
                    };
                    
                } catch (error) {
                    console.log('Fallback a memoria temporal:', error);
                    
                    // Fallback: guardar en memoria de la sesi√≥n del navegador
                    const audioBlob = new Blob([audioData], { type: file.type });
                    const permanentUrl = URL.createObjectURL(audioBlob);
                    
                    window.customAudio = {
                        url: permanentUrl,
                        name: file.name,
                        type: file.type
                    };
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Funci√≥n para cargar audio guardado
        function loadSavedAudio() {
            // Intentar cargar desde IndexedDB
            try {
                const dbRequest = indexedDB.open('SoundButtonDB', 1);
                
                dbRequest.onsuccess = function(event) {
                    const db = event.target.result;
                    if (db.objectStoreNames.contains('sounds')) {
                        const transaction = db.transaction(['sounds'], 'readonly');
                        const store = transaction.objectStore('sounds');
                        const request = store.get('myCustomSound');
                        
                        request.onsuccess = function(event) {
                            const result = event.target.result;
                            if (result && result.data) {
                                // Crear blob y URL desde los datos guardados
                                const audioBlob = new Blob([result.data], { type: result.type });
                                const audioUrl = URL.createObjectURL(audioBlob);
                                
                                audioPlayer.src = audioUrl;
                                soundButton.disabled = false;
                                soundButton.textContent = 'üéµ ¬°Reproducir!';
                                
                                // Mostrar informaci√≥n del archivo guardado
                                fileInfo.style.display = 'block';
                                fileName.textContent = result.name + ' ‚úÖ (Cargado)';
                                fileName.style.color = '#2e7d32';
                                
                                // Mostrar mensaje de √©xito
                                showMessage('‚úÖ Tu sonido guardado est√° listo!', '#4CAF50');
                                
                                console.log('Audio cargado desde IndexedDB:', result.name);
                            }
                        };
                    }
                };
                
            } catch (error) {
                console.log('No se pudo cargar desde IndexedDB:', error);
                
                // Fallback: intentar cargar desde memoria temporal
                if (window.customAudio && window.customAudio.url) {
                    audioPlayer.src = window.customAudio.url;
                    soundButton.disabled = false;
                    soundButton.textContent = 'üéµ ¬°Reproducir!';
                    
                    fileInfo.style.display = 'block';
                    fileName.textContent = window.customAudio.name + ' ‚ö†Ô∏è (Temporal)';
                    fileName.style.color = '#ff9800';
                    
                    return true;
                }
            }
            
            return false;
        }

        // Funci√≥n para mostrar mensajes
        function showMessage(text, color) {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed; 
                top: 20px; 
                left: 50%; 
                transform: translateX(-50%); 
                background: ${color}; 
                color: white; 
                padding: 10px 20px; 
                border-radius: 25px; 
                z-index: 1000;
                font-size: 0.9em;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            `;
            msg.textContent = text;
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.opacity = '0';
                msg.style.transition = 'opacity 0.5s';
                setTimeout(() => msg.remove(), 500);
            }, 3000);
        }

        // Cargar audio al iniciar la p√°gina
        window.addEventListener('load', function() {
            loadSavedAudio();
        });

        // Manejar selecci√≥n de archivo
        audioFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Guardar el nuevo audio
                saveAudioToStorage(file);
                
                // Configurar reproductor
                const url = URL.createObjectURL(file);
                audioPlayer.src = url;
                window.customAudio = {
                    url: url,
                    name: file.name,
                    type: file.type
                };
                
                soundButton.disabled = false;
                soundButton.textContent = 'üéµ ¬°Reproducir!';
                
                // Mostrar informaci√≥n del archivo
                fileInfo.style.display = 'block';
                fileName.textContent = file.name + ' üíæ (Guardando...)';
                fileName.style.color = '#ff9800';
                
                // Confirmar guardado despu√©s de un momento
                setTimeout(() => {
                    fileName.textContent = file.name + ' ‚úÖ (Guardado)';
                    fileName.style.color = '#2e7d32';
                }, 1000);
                
                // Reset audio enabled flag
                audioEnabled = false;
                
                // Mostrar mensaje de confirmaci√≥n
                showMessage('üíæ Sonido guardado en tu navegador!', '#FF6B6B');
            }
        });

        // Manejar click del bot√≥n
        soundButton.addEventListener('click', function() {
            if (!audioEnabled) {
                // Primer toque - activar audio (necesario en m√≥viles)
                audioPlayer.play().then(() => {
                    audioEnabled = true;
                    soundButton.textContent = 'üîä ¬°Toca para sonar!';
                }).catch(e => {
                    console.log('Error al activar audio:', e);
                });
            } else {
                // Reproducir sonido
                audioPlayer.currentTime = 0; // Reiniciar desde el principio
                audioPlayer.play().catch(e => {
                    console.log('Error al reproducir:', e);
                });
            }
        });

        // Agregar efecto visual al reproducir
        audioPlayer.addEventListener('play', function() {
            soundButton.style.transform = 'scale(0.95)';
            setTimeout(() => {
                soundButton.style.transform = 'translateY(-5px)';
            }, 100);
        });

        // Vibraci√≥n en m√≥viles (si est√° disponible)
        soundButton.addEventListener('click', function() {
            if (navigator.vibrate && audioEnabled) {
                navigator.vibrate(50);
            }
        });

        // Prevenir que se pierda el audio al recargar
        window.addEventListener('beforeunload', function() {
            // El audio ya est√° guardado en window.customAudio
            console.log('P√°gina cerrada - Audio permanece guardado');
        });
    </script>
</body>
</html>
